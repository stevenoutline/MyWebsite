(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[823],{8981:function(e,t,a){"use strict";a.d(t,{Ol:function(){return u},Zb:function(){return c},eW:function(){return d}});var n=a(7294),r=a(9632),l=a(4520),i=(...e)=>e.filter(Boolean).join(" "),[s,o]=(0,r.eC)("Card"),c=(0,r.Gp)(function(e,t){let{className:a,children:o,direction:c="column",justify:d,align:u,...m}=(0,l.Lr)(e),p=(0,r.jC)("Card",e);return n.createElement(r.m$.div,{ref:t,className:i("chakra-card",a),__css:{display:"flex",flexDirection:c,justifyContent:d,alignItems:u,position:"relative",minWidth:0,wordWrap:"break-word",...p.container},...m},n.createElement(s,{value:p},o))}),d=(0,r.Gp)(function(e,t){let{className:a,...l}=e,s=o();return n.createElement(r.m$.div,{ref:t,className:i("chakra-card__body",a),__css:s.body,...l})});(0,r.Gp)(function(e,t){let{className:a,justify:l,...s}=e,c=o();return n.createElement(r.m$.div,{ref:t,className:i("chakra-card__footer",a),__css:{display:"flex",justifyContent:l,...c.footer},...s})});var u=(0,r.Gp)(function(e,t){let{className:a,...l}=e,s=o();return n.createElement(r.m$.div,{ref:t,className:i("chakra-card__header",a),__css:s.header,...l})})},3234:function(e,t,a){"use strict";a.d(t,{NI:function(){return x},Yp:function(){return y},lX:function(){return E}});var n=a(7294),r=a(8387),l=a(6734),i=a(9632),s=a(4520),o=a(2494),c=(...e)=>e.filter(Boolean).join(" "),d=e=>e?"":void 0,u=e=>!!e||void 0;function m(...e){return function(t){e.some(e=>(null==e||e(t),null==t?void 0:t.defaultPrevented))}}var[p,f]=(0,r.k)({name:"FormControlStylesContext",errorMessage:"useFormControlStyles returned is 'undefined'. Seems you forgot to wrap the components in \"<FormControl />\" "}),[h,v]=(0,r.k)({strict:!1,name:"FormControlContext"}),x=(0,i.Gp)(function(e,t){let a=(0,i.jC)("Form",e),r=(0,s.Lr)(e),{getRootProps:o,htmlProps:u,...m}=function(e){let{id:t,isRequired:a,isInvalid:r,isDisabled:i,isReadOnly:s,...o}=e,c=(0,n.useId)(),u=t||`field-${c}`,m=`${u}-label`,p=`${u}-feedback`,f=`${u}-helptext`,[h,v]=(0,n.useState)(!1),[x,y]=(0,n.useState)(!1),[_,g]=(0,n.useState)(!1),E=(0,n.useCallback)((e={},t=null)=>({id:f,...e,ref:(0,l.lq)(t,e=>{e&&y(!0)})}),[f]),k=(0,n.useCallback)((e={},t=null)=>({...e,ref:t,"data-focus":d(_),"data-disabled":d(i),"data-invalid":d(r),"data-readonly":d(s),id:e.id??m,htmlFor:e.htmlFor??u}),[u,i,_,r,s,m]),I=(0,n.useCallback)((e={},t=null)=>({id:p,...e,ref:(0,l.lq)(t,e=>{e&&v(!0)}),"aria-live":"polite"}),[p]),b=(0,n.useCallback)((e={},t=null)=>({...e,...o,ref:t,role:"group"}),[o]),C=(0,n.useCallback)((e={},t=null)=>({...e,ref:t,role:"presentation","aria-hidden":!0,children:e.children||"*"}),[]);return{isRequired:!!a,isInvalid:!!r,isReadOnly:!!s,isDisabled:!!i,isFocused:!!_,onFocus:()=>g(!0),onBlur:()=>g(!1),hasFeedbackText:h,setHasFeedbackText:v,hasHelpText:x,setHasHelpText:y,id:u,labelId:m,feedbackId:p,helpTextId:f,htmlProps:o,getHelpTextProps:E,getErrorMessageProps:I,getRootProps:b,getLabelProps:k,getRequiredIndicatorProps:C}}(r),f=c("chakra-form-control",e.className);return n.createElement(h,{value:m},n.createElement(p,{value:a},n.createElement(i.m$.div,{...o({},t),className:f,__css:a.container})))});function y(e){let{isDisabled:t,isInvalid:a,isReadOnly:n,isRequired:r,...l}=function(e){let t=v(),{id:a,disabled:n,readOnly:r,required:l,isRequired:i,isInvalid:s,isReadOnly:o,isDisabled:c,onFocus:d,onBlur:u,...p}=e,f=e["aria-describedby"]?[e["aria-describedby"]]:[];return(null==t?void 0:t.hasFeedbackText)&&(null==t?void 0:t.isInvalid)&&f.push(t.feedbackId),(null==t?void 0:t.hasHelpText)&&f.push(t.helpTextId),{...p,"aria-describedby":f.join(" ")||void 0,id:a??(null==t?void 0:t.id),isDisabled:n??c??(null==t?void 0:t.isDisabled),isReadOnly:r??o??(null==t?void 0:t.isReadOnly),isRequired:l??i??(null==t?void 0:t.isRequired),isInvalid:s??(null==t?void 0:t.isInvalid),onFocus:m(null==t?void 0:t.onFocus,d),onBlur:m(null==t?void 0:t.onBlur,u)}}(e);return{...l,disabled:t,readOnly:n,required:r,"aria-invalid":u(a),"aria-required":u(r),"aria-readonly":u(n)}}x.displayName="FormControl",(0,i.Gp)(function(e,t){let a=v(),r=f(),l=c("chakra-form__helper-text",e.className);return n.createElement(i.m$.div,{...null==a?void 0:a.getHelpTextProps(e,t),__css:r.helperText,className:l})}).displayName="FormHelperText";var[_,g]=(0,r.k)({name:"FormErrorStylesContext",errorMessage:"useFormErrorStyles returned is 'undefined'. Seems you forgot to wrap the components in \"<FormError />\" "});(0,i.Gp)((e,t)=>{let a=(0,i.jC)("FormError",e),r=(0,s.Lr)(e),l=v();return(null==l?void 0:l.isInvalid)?n.createElement(_,{value:a},n.createElement(i.m$.div,{...null==l?void 0:l.getErrorMessageProps(r,t),className:c("chakra-form__error-message",e.className),__css:{display:"flex",alignItems:"center",...a.text}})):null}).displayName="FormErrorMessage",(0,i.Gp)((e,t)=>{let a=g(),r=v();if(!(null==r?void 0:r.isInvalid))return null;let l=c("chakra-form__error-icon",e.className);return n.createElement(o.JO,{ref:t,"aria-hidden":!0,...e,__css:a.icon,className:l},n.createElement("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"}))}).displayName="FormErrorIcon";var E=(0,i.Gp)(function(e,t){let a=(0,i.mq)("FormLabel",e),r=(0,s.Lr)(e),{className:l,children:o,requiredIndicator:d=n.createElement(k,null),optionalIndicator:u=null,...m}=r,p=v(),f=(null==p?void 0:p.getLabelProps(m,t))??{ref:t,...m};return n.createElement(i.m$.label,{...f,className:c("chakra-form__label",r.className),__css:{display:"block",textAlign:"start",...a}},o,(null==p?void 0:p.isRequired)?d:u)});E.displayName="FormLabel";var k=(0,i.Gp)(function(e,t){let a=v(),r=f();if(!(null==a?void 0:a.isRequired))return null;let l=c("chakra-form__required-indicator",e.className);return n.createElement(i.m$.span,{...null==a?void 0:a.getRequiredIndicatorProps(e,t),__css:r.requiredIndicator,className:l})});k.displayName="RequiredIndicator"},979:function(e,t,a){"use strict";a.d(t,{BZ:function(){return f},II:function(){return u},xH:function(){return I}});var n=a(7294),r=a(3234),l=a(9632),i=a(4520),s=a(5336),o=a(8387),c=a(4031),d=a(6076),u=(0,l.Gp)(function(e,t){let{htmlSize:a,...o}=e,c=(0,l.jC)("Input",o),d=(0,i.Lr)(o),u=(0,r.Yp)(d),m=(0,s.cx)("chakra-input",e.className);return n.createElement(l.m$.input,{size:a,...u,__css:c.field,ref:t,className:m})});u.displayName="Input",u.id="Input";var[m,p]=(0,o.k)({name:"InputGroupStylesContext",errorMessage:"useInputGroupStyles returned is 'undefined'. Seems you forgot to wrap the components in \"<InputGroup />\" "}),f=(0,l.Gp)(function(e,t){let a=(0,l.jC)("Input",e),{children:r,className:o,...u}=(0,i.Lr)(e),p=(0,s.cx)("chakra-input__group",o),f={},h=(0,c.W)(r),v=a.field;h.forEach(e=>{a&&(v&&"InputLeftElement"===e.type.id&&(f.paddingStart=v.height??v.h),v&&"InputRightElement"===e.type.id&&(f.paddingEnd=v.height??v.h),"InputRightAddon"===e.type.id&&(f.borderEndRadius=0),"InputLeftAddon"===e.type.id&&(f.borderStartRadius=0))});let x=h.map(t=>{var a,r;let l=(0,d.oA)({size:(null==(a=t.props)?void 0:a.size)||e.size,variant:(null==(r=t.props)?void 0:r.variant)||e.variant});return"Input"!==t.type.id?(0,n.cloneElement)(t,l):(0,n.cloneElement)(t,Object.assign(l,f,t.props))});return n.createElement(l.m$.div,{className:p,ref:t,__css:{width:"100%",display:"flex",position:"relative"},...u},n.createElement(m,{value:a},x))});f.displayName="InputGroup";var h={left:{marginEnd:"-1px",borderEndRadius:0,borderEndColor:"transparent"},right:{marginStart:"-1px",borderStartRadius:0,borderStartColor:"transparent"}},v=(0,l.m$)("div",{baseStyle:{flex:"0 0 auto",width:"auto",display:"flex",alignItems:"center",whiteSpace:"nowrap"}}),x=(0,l.Gp)(function(e,t){let{placement:a="left",...r}=e,l=h[a]??{},i=p();return n.createElement(v,{ref:t,...r,__css:{...i.addon,...l}})});x.displayName="InputAddon";var y=(0,l.Gp)(function(e,t){return n.createElement(x,{ref:t,placement:"left",...e,className:(0,s.cx)("chakra-input__left-addon",e.className)})});y.displayName="InputLeftAddon",y.id="InputLeftAddon";var _=(0,l.Gp)(function(e,t){return n.createElement(x,{ref:t,placement:"right",...e,className:(0,s.cx)("chakra-input__right-addon",e.className)})});_.displayName="InputRightAddon",_.id="InputRightAddon";var g=(0,l.m$)("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:"0",zIndex:2}}),E=(0,l.Gp)(function(e,t){let{placement:a="left",...r}=e,l=p(),i=l.field,s={["left"===a?"insetStart":"insetEnd"]:"0",width:(null==i?void 0:i.height)??(null==i?void 0:i.h),height:(null==i?void 0:i.height)??(null==i?void 0:i.h),fontSize:null==i?void 0:i.fontSize,...l.element};return n.createElement(g,{ref:t,__css:s,...r})});E.id="InputElement",E.displayName="InputElement";var k=(0,l.Gp)(function(e,t){let{className:a,...r}=e,l=(0,s.cx)("chakra-input__left-element",a);return n.createElement(E,{ref:t,placement:"left",className:l,...r})});k.id="InputLeftElement",k.displayName="InputLeftElement";var I=(0,l.Gp)(function(e,t){let{className:a,...r}=e,l=(0,s.cx)("chakra-input__right-element",a);return n.createElement(E,{ref:t,placement:"right",className:l,...r})});I.id="InputRightElement",I.displayName="InputRightElement"},6743:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/adminer/default",function(){return a(7129)}])},7129:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return N}});var n=a(5893),r=a(7294),l=a(2494),i=a(8387),s=a(9632),o=a(4520),[c,d]=(0,i.k)({name:"TagStylesContext",errorMessage:"useTagStyles returned is 'undefined'. Seems you forgot to wrap the components in \"<Tag />\" "}),u=(0,s.Gp)((e,t)=>{let a=(0,s.jC)("Tag",e),n=(0,o.Lr)(e),l={display:"inline-flex",verticalAlign:"top",alignItems:"center",maxWidth:"100%",...a.container};return r.createElement(c,{value:a},r.createElement(s.m$.span,{ref:t,...n,__css:l}))});u.displayName="Tag",(0,s.Gp)((e,t)=>{let a=d();return r.createElement(s.m$.span,{ref:t,noOfLines:1,...e,__css:a.label})}).displayName="TagLabel",(0,s.Gp)((e,t)=>r.createElement(l.JO,{ref:t,verticalAlign:"top",marginEnd:"0.5rem",...e})).displayName="TagLeftIcon";var m=(0,s.Gp)((e,t)=>r.createElement(l.JO,{ref:t,verticalAlign:"top",marginStart:"0.5rem",...e}));m.displayName="TagRightIcon";var p=e=>r.createElement(l.JO,{verticalAlign:"inherit",viewBox:"0 0 512 512",...e},r.createElement("path",{fill:"currentColor",d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"}));p.displayName="TagCloseIcon",(0,s.Gp)((e,t)=>{let{isDisabled:a,children:n,...l}=e,i=d(),o={display:"flex",alignItems:"center",justifyContent:"center",outline:"0",...i.closeButton};return r.createElement(s.m$.button,{ref:t,"aria-label":"close",...l,type:"button",disabled:a,__css:o},n||r.createElement(p,null))}).displayName="TagCloseButton";var f=a(8641),h=a(7741),v=a(979),x=a(3382),y=a(8981),_=a(5434);let g=e=>{let{direction:t,type:a,content:r,timestamp:i}=e;return(0,n.jsxs)(f.kC,{direction:"ask"===t?"row-reverse":"row",columnGap:3,children:["answer"===t&&(0,n.jsx)(l.JO,{h:8,w:8,as:_.Vyx}),(0,n.jsx)(y.Zb,{p:3,mr:2,mb:2,maxW:"80%",children:(0,n.jsx)(f.xv,{children:r})})]})};var E=a(9583),k=a(2829),I=a(1163),b=a.n(I);let C=e=>{let{email:t,isNew:a=!1,selected:r=!1,onClick:l}=e;return(0,n.jsxs)(u,{cursor:"pointer",variant:r?"solid":"outline",colorScheme:"blue",size:"lg",_hover:r?{}:{bg:"gray.300"},onClick:l,children:[t,a&&(0,n.jsx)(m,{as:x.kB})]})},w=()=>{let[e,t]=r.useState(null),[a,i]=r.useState(null),[s,o]=r.useState(""),[c,d]=r.useState(0),[u,m]=r.useState(""),[p,x]=r.useState(""),[y,_]=r.useState(!1),[I,w]=r.useState(0),[N,j]=r.useState(0),S=r.useContext(k.V),G=r.useRef(null),A=async()=>{let e=await fetch("http://10.7.1.102:8000/api/chat/devices",{headers:{Authorization:"Bearer ".concat(S.token)}}),a=await e.json();if(200!==a.status)o(a.msg);else{let n=a.data.devices;t(n),d(a.data.timestamp),n.length>0&&m(n[0].device_code)}},z=async()=>{let a=await fetch("http://10.7.1.102:8000/api/chat/devicesafter?timestamp="+c,{headers:{Authorization:"Bearer ".concat(S.token)}}),n=await a.json();if(200!==n.status)o(n.msg);else if(d(n.data.timestamp),e&&n.data.devices){let r=e.slice();n.data.devices.map(e=>{let t=r.find(t=>t.device_code===e.device_code);t?t.new=e.new:r.push(e)}),t(r)}else n.data.devices&&t(n.data.devices)},F=async()=>{let e=await fetch("http://10.7.1.102:8000/api/chat/device?device_code="+u,{headers:{Authorization:"Bearer ".concat(S.token)}}),t=await e.json();200!==t.status?o(t.msg):(d(t.data.timestamp),i(t.data.msgs))},R=async()=>{let e=await fetch("http://10.7.1.102:8000/api/chat/deviceafter?device_code="+u+"&timestamp="+c,{headers:{Authorization:"Bearer ".concat(S.token)}}),t=await e.json();if(200!==t.status)o(t.msg);else{d(t.data.timestamp);let a=t.data.msgs;i(e=>e?[...e,...a]:[...a])}},L=async()=>{let a=await fetch("http://10.7.1.102:8000/api/chat/answer",{method:"POST",headers:{Authorization:"Bearer ".concat(S.token),Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({type:"text",content:p,device_code:u})}),n=await a.json();if(200!==n.status)o(n.msg);else{d(n.data.timestamp);let r={direction:"answer",type:"text",content:p,timestamp:n.data.timestamp};if(i(e=>e?[...e,r]:[r]),e){let l=e.slice(),s=l.findIndex(e=>e.device_code===u);l[s]&&(l[s].new=!1),t(l)}}x("")},T=()=>{S.logout(),b().push("/adminer/login")},$=()=>(0,n.jsxs)(f.kC,{children:[(0,n.jsx)(h.zx,{onClick:T,children:"退出"})," ",(0,n.jsx)(h.zx,{onClick:()=>A(),children:"设备列表"}),(0,n.jsx)(h.zx,{onClick:()=>z(),children:"最新设备"}),(0,n.jsx)(h.zx,{onClick:()=>F(),children:"消息列表"}),(0,n.jsx)(h.zx,{onClick:()=>R(),children:"最新消息"}),(0,n.jsx)(h.zx,{onClick:()=>L(),children:"回复消息"})]});r.useEffect(()=>{if(S.token){let e=async()=>{await A()};e()}},[]),r.useEffect(()=>{if(u){let e=async()=>{await F()};e()}},[u]),r.useEffect(()=>{let e=setInterval(async()=>{S.token&&await z(),w(I+1)},5e3);return()=>clearInterval(e)},[I]),r.useEffect(()=>{let e=setInterval(async()=>{S.token&&await F(),j(N+1)},5e3);return()=>clearInterval(e)},[N]);let O=async()=>{_(!0),await L(),_(!1)};return r.useEffect(()=>{G.current&&(G.current.scrollTop=G.current.scrollHeight-G.current.clientHeight)},[a]),(0,n.jsxs)(f.W2,{minW:"md",maxW:"6xl",height:"95vh",children:[(0,n.jsx)($,{}),(0,n.jsxs)(f.kC,{direction:"row",w:"full",h:"full",children:[(0,n.jsx)(f.kC,{direction:"column",flex:1,px:5,pt:10,rowGap:3,children:e&&e.map(e=>(0,n.jsx)(C,{isNew:e.new,selected:u===e.device_code,email:e.email||"匿名用户",device_code:e.device_code,onClick:()=>{m(e.device_code)}},e.device_code))}),(0,n.jsx)(f.iz,{orientation:"vertical"}),(0,n.jsxs)(f.xu,{flex:4,pt:10,children:[(0,n.jsx)(f.kC,{ref:G,direction:"column",rowGap:2,h:"80vh",overflowY:"auto",children:a&&a.map(e=>(0,n.jsx)(g,{...e},e.timestamp))}),(0,n.jsx)(f.iz,{my:5}),(0,n.jsxs)(v.BZ,{px:5,mb:5,children:[(0,n.jsx)(v.II,{variant:"unstyled",placeholder:"请输入",onChange:e=>x(e.target.value),value:p}),(0,n.jsx)(v.xH,{children:(0,n.jsx)(h.hU,{variant:"unstyled","aria-label":"发送",icon:(0,n.jsx)(l.JO,{color:"telegram.500",h:6,w:6,as:E.AGi}),onClick:O,isLoading:y})})]})]})]})]})};w.Layout="blank";var N=w}},function(e){e.O(0,[774,888,179],function(){return e(e.s=6743)}),_N_E=e.O()}]);